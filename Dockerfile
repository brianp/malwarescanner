FROM golang:alpine3.7
MAINTAINER Brian Pearce

RUN apk update && \
    apk add \
      clamav \
      clamav-dev \
      curl \
      gcc \
      git \
      libc-dev \
      pkgconfig && \
    rm -rf /var/cache/apk/*

WORKDIR /go/src/github.com/brianp/malwarescan
COPY . /go/src/github.com/brianp/malwarescan

RUN mkdir -p cvd
RUN chown 100:100 ./cvd && \
    chmod 750 ./cvd
RUN freshclam --datadir=cvd

RUN go-wrapper download
RUN go-wrapper install

CMD ["go-wrapper", "run"]
